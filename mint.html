<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHC Mint Site</title>
    
</head>
<body>
    <Header class="row container"> 
        <a href="#" class="logo">
            logo
        </a>
        <div class="toggleMenu" onclick="toggleMenu();"></div>
        <nav class="navigation row">
            <ul class="row">
                <li><a target="_blank" href="https://opensea.io/">Collection</a></li>
                <li><a target="_blank" href="#">Roadmap</a></li>
                <li><button class="hero-btn" id="connect-wallet"> Connect Wallet </button>
                    <button class="hero-btn" id="disconnect-wallet"> Disconnect Wallet </button>
                    <div id="message"></div>
                </li>
            </ul>
        </nav>
    </Header>

    <section class="hero row container">
        <div>
            <h6>Mint Now</h6>
            <h1>Our Unique NFT Collection</h1>
            <a onclick="" class="hero-btn">Mint now</a>
        </div>
    </section>

<script type="text/javascript" src="https://unpkg.com/web3@1.6.0/dist/web3.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/web3modal@1.9.4/dist/index.js"></script>
<script type="text/javascript" src="https://unpkg.com/@walletconnect/web3-provider@1.6.6/dist/umd/index.min.js"></script>
<script type="text/javascript" src="walletlink.bundle.js"></script>

<script type="text/javascript">
    //  You have to refer to default since it was bundled for ESModules
    // but after that the documentation will be the same
    const Web3Modal = window.Web3Modal.default;
    const WalletConnectProvider = window.WalletConnectProvider.default;

    let Web3Provider;
    let Web3Instance;

    const providerOptions = {
        walletconnect: {
            package: WalletConnectProvider,
            options: {
                infuraId: "acac9625aa514dfebaa00c8735600dff",
            }
        },
        walletlink: {
        package: WalletLink, // Required
        options: {
        appName: "DHC", // Required
        infuraId: "acac9625aa514dfebaa00c8735600dff", // Required unless you provide a JSON RPC url; see `rpc` below
        rpc: "", // Optional if `infuraId` is provided; otherwise it's required
        chainId: 1, // Optional. It defaults to 1 if not provided
        appLogoUrl: null, // Optional. Application logo image URL. favicon is used if unspecified
        darkMode: true // Optional. Use dark theme, defaults to false
    }
  }
        /* See Provider Options Section */
    };

    const web3Modal = new Web3Modal({
        network: "mainnet", // optional
        cacheProvider: false, // optional
        providerOptions // required
    });
</script>

<script>

    const WalletConnector = function (messageBox, connectWalletButton, disconnectWalletButton) {
        this.messageBox = messageBox ? messageBox : document.getElementById('message'),
        this.connectWalletButton = connectWalletButton ? connectWalletButton : document.getElementById('connect-wallet'),
        this.disconnectWalletButton = disconnectWalletButton ? disconnectWalletButton : document.getElementById('disconnect-wallet'),
        this.account = "",
        this.walletConnected = false,
        this.init = function () {
            if (!(this.connectWalletButton && this.connectWalletButton instanceof Element)) {
                throw "connectWalletButton must be a DOM Element"
            }
            if (!(this.disconnectWalletButton && this.disconnectWalletButton instanceof Element)) {
                throw "disconnectWalletButton must be a DOM Element"
            }
            this.connectWalletButton.addEventListener('click', () => {
                this.connectWallet()
            })
            this.disconnectWalletButton.addEventListener('click', () => {
                this.disconnectWallet()
            })
        },
        this.checkProviderIfLoggedIn = async function () {
            if (this.walletConnected && providerLoggedInWith == 'walletconnect') {
                Web3Provider = await web3Modal.connectTo('walletconnect')
            }
        },
        this.showMessage = function (message) {
            this.messageBox.innerText = message
        },
        this.connectWallet = async function () {
            try {

                Web3Provider = await web3Modal.connect()
                this.account = await this.fetchAccountData()

                this.walletConnected = true
                this.showMessage("Here's your Wallet: " + this.account)


            } catch (e) {
                if (e.code == "4001") {
                    this.showMessage(e.message)
                } else {
                    this.showMessage("Couldn't get the wallet connection")
                }
                console.log("Couldn't get a wallet connection")
                console.log(e)
            }

            this.initProviderEvents();
        },
        this.disconnectWallet = async function () {

            // Try to close the web3 session 
            try {
                await Web3Provider.close()
            } catch (e) {
                console.log(e)
            }

            // Also clear the cacheProvider so it asks for wallet options again, instead of asking the login of previous provider
            try {
                await web3Modal.clearCachedProvider();
            } catch (e) {
                console.log(e)
            }

        },
        this.fetchAccountData = async function () {
            // Get a Web3 instance for the wallet
            Web3Instance = new Web3(Web3Provider)

            // Get list of accounts of the connected wallet
            const accounts = await Web3Instance.eth.getAccounts()

            selectedAccount = accounts[0].toLowerCase()
            return selectedAccount
        },

        this.initProviderEvents = function () {

            // Subscribe to accounts change
            Web3Provider.on("networkChanged", (accounts) => {
                console.log("networkChanged");
                console.log(accounts);
            });

            Web3Provider.on("accountsChanged", (accounts) => {
                console.log("accountsChanged");
                console.log(accounts);
            });

            // Subscribe to chainId change
            Web3Provider.on("chainChanged", (chainId) => {
                console.log("chainChanged");

                console.log(chainId);
            });

            // Subscribe to provider connection
            Web3Provider.on("connect", (info) => {
                console.log("connect");

                console.log(info);
            });

            // Subscribe to provider disconnection
            Web3Provider.on("disconnect", (error) => {
                this.showMessage("Disconnected")
                console.log("disconnect");
                console.log(error);
            });

        }
    }

    let walletConnector = new WalletConnector()
    walletConnector.init();
</script>
</body>
</html>